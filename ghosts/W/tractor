
hooks:

  wongawonga: |
    die
  Arr: |
    G.W = O.W;
    my @AA;
    my @_A = w tractors;
    for my $A (@_A) {
        if (w $A arr_if) {
        
            push @AA, $A->spawn();
        }
    }
    
    if (!@AA) {
        die "No traction for! ".ki($ar);
    }
    
    die "CROWD OF TRACTORS" if @AA > 1;
    for my $A (@AA) {
        $A->{B} = { %$ar };
        if (my $B_ = w $A B_) {
            $A->{B}->{_} = $B_;
        }
    }
    
    my @AAA;
    for my $A (@AA) {
        A._fresh = 1;
        my $a = 0->Tafu($A) || die "WTf";
        
        if (a._fresh) {
            delete a._fresh;
            $G->Flab("A first", $a);
            w $a first_time;
        }
        else {
            # in case some non-B_ affecting B{ thing changes
            a.B = { %{a.B}, %{A.B} };
            $G->Flab("AAAA    \t", $a);
            w $a nonfirst_times;
        }
        
        w $a every_time;
        $G->_0(sing => {
            name => "populi $G->{name}",
            again_after => 3,
            begin_after => 1,
            code => sub {
              w populi;
            },
        });
            
        my $p = w $a print;
        a.name ||= $p || "nowame";
        
        push @AAA, $a;
    }
    
    return @AAA;
  tractors: |
    grep { !$_->{_disabled} } map { @{$_} } $G->anyway('tractors');
  populi: |
    my ($A) = w tractors;
    my $s = $G->W->{script};
    if (my $max = $A->find('populi/max')) {
        shift @$s until @$s <= $max;
    }
    my $hp = 'populi/hooks';
    if (my $h = $A->find($hp)) {
        for my $he (keys %$h) {
            $G->w("$hp/$he", $ar, $A);
        }
    }
  Afu: |
    die "FIND DOES EXIST BUT LETS CHECK";
    return 0->fu(
        $G->nw()->from({B=>$ar})
    );
    my @wheres;
    while (my ($k, $v) = each %$ar) {
        push @wheres, [ $k, $v ];
    }
    for my $line (@{ $G->W->{script} }) {
        #$H->info("Line: $line", $O->{name}, $line);
        next if ref $line eq "ARRAY" && @$line == 0; # wtf case
        my $A = $line->{i};
        next if ref $A ne "Way";
        return $A if @wheres == grep {
            !exists $A->{B}->{$_->[0]} ||
                $A->{B}->{$_->[0]} eq $_->[1]          } @wheres
    }

