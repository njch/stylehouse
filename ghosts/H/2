hooks:
  in: |
    w hostinfo;
    $H->pub("Hi" => "H.style/H.name/H.id $$");
    $G->recur(9 => sub {
        w hostinfo;
    });
    $G->recur(6 => sub {
        H.r->set("H/H.style/H.name/H.id" => $H->hitime); # TODO lots
    });
  hostinfo: |
    my @ps = `ps -p$$ fu`;
    my ($u, $pid, $mem, $cpu) = (split /\s+/, $ps[1])[0,1,2,3];
    $_ = $_ / 100 for $cpu, $mem;
    
    my $info = "H.style/H.name/H.id $cpu $mem ".$H->hitime;
    
    saygr "hostinfo: $info " if rand(1) > 0.7;
    $H->pub("Hostinfo" => $info, 'ig');
    
    G.hostinfo_waits++;
    if (G.hostinfo_waits > 1) {
        sayre "hostinfo uncollected";
    }
      
  S:
    hostinfo:
      ack: |
        my (@s) = split /\s+/, $m;
        saygr "hostinfo ack: $m";
        if (rand(1) > 0) {
            my $lag = (1000*sprintf('%.3f',$H->hitime - $s[-1])).'ms';
            sayyl "out there! lag: $lag";
        }
        G.hostinfo_waits = 0;

