hooks:
  node:
    O: #c
      - GAK: S/O
    o: #c
      - GAK: S/o
    C: #c
      - GAK: C
    
      - GAK: sul C/ool
        P:
            - K: Ims
              flo: 4
              B:
                dir: /s/public/i
            - GAK: U
              InC:
                   W:
                     styles: OxO z NZ
                     Z:
                       z-index: 5
                       overflow: hidden
                       background: url(i/jellyfish-6.jpg)
    D: #c
      - GAK: C
    
      - GAK: sul C/ool
        P:
            - K: Ims
              flo: 4
              B:
                dir: /s/public/i
            - GAK: U
              InC:
                   W:
                     styles: OxO z NZ
                     Z:
                       z-index: 5
                       overflow: hidden
                       background: url(i/future-games-fractal.jpg)
    S2: #c
      - GAK: sul C/ool
        P:
            - K: Ims
              flo: 4
              B:
                dir: /s/public/i
            - GAK: U
              InC:
                   W:
                     styles: OxO z NZ
                     Z:
                       z-index: 5
                       overflow: hidden
                       background: url(i/aloe-vera-1045_640.jpg)
    S: #c
       - GAK: bacg C/ool
         P:
          - K: Ims
            flo: 2
            B:
              dir: /s/public/i
          - GAK: U
            InC:
                 W:
                   Z:
                     z-index: -1
                     background: url(i/greencush.jpg)
    s: #c
       - GAK: sl C/ool
         P:
          - K: Ims
            flo: 2
            B:
              dir: /s/public/i
          - GAK: U
            InC:
                 W:
                   styles: OxO z NZ
                   Z:
                     z-index: -1
                     background: url(i/greencush.jpg)
    Z: #c
      - GAK: 0
      - D: | #c gitdission
          $G->recur(0.4, sub {
              my $some = 0;
              for my $f ($G->fs_find('/home/s/styleshed/ghosts')) {
                  next if $f =~ /\/\./;
                  my $mt = (stat $f)[9];
                  $some = 1 if
                  G.gitdissmt->{$f} ne $mt;
                  G.gitdissmt->{$f} = $mt;
              }
              return unless $some;
              w gitdission;  
          });
  in: |
    if (H.name ne 'o') {
        w hostinfo;
    }
    $G->recur(9 => sub {
        w hostinfo;
    });
  hostinfo: |
    my @ps = `ps -p$$ fu`;
    my ($u, $pid, $mem, $cpu) = (split /\s+/, $ps[1])[0,1,2,3];
    $_ = $_ / 100 for $cpu, $mem;
    my $now = $H->hitime;
    
    my $hol = H.ol ||= "H.style/H.name/H.id";
    my $info = "$cpu $mem $now";
    
    saygr "hostinfo: $info " if rand(1) > 0.7;
    H.r->set("H/$hol", $info);
    
    $H->pub("Hostinfo" => "$hol $info", 'ig');
    
    $H->pub("Hi" => $hol) if !H.lastinfo || ar.withHi;
    H.lastinfo = $now;
    
    G.hostinfo_waits++;
    if (G.hostinfo_waits > 1) {
        sayre "hostinfo uncollected";
    }
      
  S:
    hostinfo: #c
      ack: | #c
        my (@s) = split /\s+/, $m;
        if (rand(1) > 0) {
            my $lag = (1000*sprintf('%.3f',$H->hitime - $s[-1])).'ms';
            sayyl "out there! lag: $lag";
        }
        G.hostinfo_waits = 0;

