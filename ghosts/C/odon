name: code
include: T/ravel T/braid
chains:
 - K: 'stylefile'#c
   Ki: 'styledir'
   arr_if: |
     1 || -d "$thing/lib" && -d "$thing/ghosts"
   foreach_travel:
     glob: |
       "$thing/style*", "$thing/not"
     find_files: |
       #"$thing/lib",
       "$thing/ghosts"
     grep: |
         !/T|H|L/
   y:
     t:
       event: |
         Say "In Eveent";
         0->TafuB(Codon => { stylefile => L.t });
     
 - K: Codon #c
   print: |
     S.B.name;
   flows_D: |
     my $Codon = T.i;
     @{$G->W->{script}} = grep { _.i.K ne "Codon" || _.i eq $Codon } @{$G->W->{script}};
     w codonify[$Codon];
   uxs: # proto style C - gets applied fast in ux braid
     y:
       t:
         at_D: |
           at.style .= " 20pt";
     
 - K: Chunks
   Ki: Codon
   arr_if: |
     T.i.K eq "Codon"
   travels: 1
   extract_D: |
     my $Codon = T.i.Lo.i;
     w chunkify[$Codon];
   
 - K: Chunk
   print: |
     S.B.i;
   flows_D: |
     my $C = T.i;
     T.t = C.B.lines->[0] || C.B.lines->[1];
     T.t||= ki(C.B);
   y:
     t:
       event: |
         0->TafuBl("CodeMirror", { Chunk => T.i });
 
 - K: CodeMirror
   flows_D: |
     my $CM = T.i;
     my $Ch = CM.B.Chunk;
     my $C = CM.Lo.i;
     T.t = join "\n", "y", @{Ch.B.lines};
   y:
     t:
       uyB_adjust:
         raw: 1
     CodeMirror:
       is:
         K: CodeMirror
         js_D: |
           die "Jquery all that";
       

 - K: 'yaml'
   arr_if: |
     -f $thing && $thing =~ /odon/ && 1
   foreach_travel:
     each: Way::load_yaml($thing);
     
 - K: 'wc -l'
   arr_if: |
     0 && -f $thing;
   foreach_travel:
     each: (split /\s+/, `wc -l $thing`)[0];
     
dials:
  max_depth: 3
hooks:
  figure_some_chain: |
    push @{G.o}, $c;
    w $c travels if c.travels;
    return 1 # all good ness
  percolate: |
    $G->T("/s", undef, $G->nw(K=>"styledir"));
    $G->T("somemmmm", undef, $G->nw(K=>"whatever"));
  codonify: |
     my $C = $Codon;
     $_ = C.B.stylefile;
     my $code = $H->slurp($_) if $_;
     C.B.name ||= do {
         /(ghost)s\/(.+)$/ ? $2 :
         /(lib)\/(.+)\.pm$/ ? $2 : $_
     };
     C.B.flav = $1 if /(ghost)s\// || /(lib)\// || /(not)$/;
     T.t = C.B.name;
     $code = C.B.code if C.B.code;
     C.B.lines = [ map { s/\n$//s; $_ } split "\n", $code ];
  
  chunkify: |
    my $C = $Codon;
    my $c = "#"."c";
    my @stuff = ([]);
    my $ghost = C.B.flav eq "ghost";
    my $not = C.B.flav eq "not";
    for my $l (@{ C.B.lines }) {
        defined $l || die "no defined l! C.B.name";
        
        push @stuff, []
        
        if
              @{$stuff[-1]} > 0
            && (
                ($ghost||$not) && $l =~ /^\w+|^  \w+/
                ||
                $l =~ /$c/
                ||
                !$ghost && $l =~ /^\S+.+ \{(?:\s+\#.+?)?$/gm
            );
            
        push @{ $stuff[-1] }, $l;
    }
    my $chunks = [];
    my $i = 0;
    for my $s (@stuff) {
        push @$chunks, {
            i => $i++,
            rows => scalar(@$s),
            lines => $s,
        };
    }
    _.Codon = $C for @$chunks; # traction to Codon
    0->TafuBl(Chunk => $_) for @$chunks;
    T.L.t = 0+@$chunks;
    return $chunks;
  event: |
    0->visTp({L=>$L},'Fun');
    my $y = "";
    $y = "/".ar.uyL.i.K if ar.uyL;
    $G->w("y$y/event", $ar, L.i);
    waylay uxd;
  uxd: |
    G.ux->w('ux', {W=>$G->W});
    $Ly->w(somewhere => {thing => $ar});
  Earr: |
    # scan events etc.
  

