name: Styling
dials:
  max_depth: 7
  form: 42
hooks:

  T_end: |
    my $t = $G->{_trail} ||= [];
    my $xL = $L; 
    
    my $yL = $xL->{t};
    my ($ytw, $ylw) = ([],[]);
    for my $yw (@{$yL->{o}}) {
        if ($yw->{B}->{Li}) {
            push @$ytw, $yw
        }
        else {
            push @$ylw, $yw
        }
    }
    my $yiw = $yL->{i};
    if (!$yiw) {
        $yiw = $G->nw()->from({K=>"TheWayIn"});
    }
    my $xiw = $xL->{i};
    
    w zerediag[$xL, $yL, $ylw, $ytw, $yiw, $xiw];
    
    #w zerediag[$xL, $yL, $ylw, $ytw, $yiw, $xiw];
    
    
    # o[ s/...
    # (re)make i s...

    return unless $xL->{depth} == 0;
    @$r = "HTML!";
    w dumptrail;
  dumptrail: |
    my $t = {
        t => $G->{_trail},
        G => $G->{name},
    };
    $G->timer(0.2, sub {
        $O->{O}->w(somewhere=>{thing=>$t,max_depth=>3});
    },"bailout");
  zerediag: |
    my @diag = ($xL->{depth}, $yL->{t});
    
    for my $ya (['l',$ylw],['t',$ytw],['y',[$yiw]]) {
        my ($y,$yww) = @$ya;
        push @diag, map {
            "!html $y ".
            (ref $_ eq "Way" ?
            ($_->pint             .($y ne 't' ?
                '<t style="color:white;">'.ki($_->{B}->{s}).'</t>' : "") )
            : "iww!www: $_")
        } @$yww
    }
    push @{ $G->{_trail} }, \@diag;
   

