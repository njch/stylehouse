pidepth: |
    my $o = $J;
    my $i = 0;
    while (o.Jiter) {
        $i++; $o = o.Jiter;
    }
    $i;
ratio: |
    my $ratio = $o / ($t||1);
    0.01 * int(100*$ratio);
    

eighthnot: |
    my ($dir) = J.id =~ /(.)$/;
    my $lim = $dir > 6 ? 6 : $dir > 3 ? 5 : 4;
    if (J.A.tch++ > $lim) {
        J.A.tch = $lim - 4;
        1
    }
    else {
        0
    }
r2j: | # interpreter of buzzed puit partiscules r -> j.[cv,t,style]
    my $j;
    my $sing;
    if (J.tt) {
        $sing = 'J_tt';
        (j.cv,j.t,j.style) = $r =~ /^(.*?)\t(.*)\t(.*?)$/;
        if (!j.cv) {
            sayre "Hind $r  ";
            (j.t,j.style,j.cv) = $r =~ /^(.+?)(?:%(.+))?\s+(.+?)$/;
        }
    }
    else {
        (j.t,j.style,j.cv) = $r =~ /^(.+?)(?:%(.+))?\s+(.+?)$/;
    }
    defined j.cv || die "$sing no $r    ".ki $j;
    j.s = ar.J.bb->{$r} if ar.J;
    j.nos = 1 if ar.J && !exists ar.J.bb->{$r};
    $j;
Ajr: | # shed A.jr bb io, aimed for J and cv,t (of C?)  send $style,$v
    sub {
        my ($s,$v,$d) = @_;
        my $isv = @_ >= 2;
        my $isd = @_ >= 3;
        my $t = exists ar.t ? ar.t : ar.C.t;
        my $cv = exists ar.cv ? ar.cv : ar.C.y.cv;
        my $r;
        if (J.tt) { # FUTU
            $r = $cv."\t".$t."\t".$s;
        }
        else {
            $s = '%'.$s if $s;
            $r = $t.$s."\t".$cv;
        }
        if ($isd) {
            return delete J.bb->{$r};
        }
        defined $v ? 
            saybl "J.name chuck $r     $v  <--  ".J.bb->{$r}
          : saygr "J.name read $r"
            if J.V;
        !$isv ?
          !exists J.bb->{$r} ? () : J.bb->{$r}
        : do {
            J.bz->($r, $v);
            sub { delete J.bb->{$r} } 
        };
    };
jamsc: | # put C in bb
    ar.C = ar.d if ar.d;
    my $t = ar.t ? ar.t
        : ar.j ? ar.j.l
        : ar.C ? ar.C.t : die'not';
    my $cv = ar.cv ? ar.cv
        : ar.j ? ar.j.cv
        : ar.C ? ar.C.cv || ar.C.y.cv : die'noy';
    if (ar.oJ && ar.oJ ne ar.J && !ar.noR) {
        my $J = ar.oJ;
        if (my $ljm = J.A.ljm) {
            my $Me = "ar.oJ.ind ar.J.name "
            ." J.A.ljmo <<< J.name  sends:"
            ." $t\t$cv  $ljm";
            sayyl $Me if J.V || ar.J.V;
            push @$ljm, {%$ar};
        }
    }
    
    my @fobz;
    push @fobz, [$cv,$t,undef,ar.s] if exists ar.s;
    push @fobz, [$cv,$t,$_,$sc->{$_}] for keys %$sc;
    my @tobz = map {
        my ($cv,$t,$s,$v) = @$_;
        my $r;
        if (J.tt) { # FUTU
            $r = $cv."\t".$t."\t".$s;
        }
        else {
            my $s = $s;
            $s = '%'.$s if $s;
            $r = $t.$s."\t".$cv;
        }
        if ($s) {
            ar.C.sc->{$s} = $v;
        }
        [$r,$v]
    } @fobz;
    
    for (@tobz) {
        my ($r,$v) = @$_;
        J.bz->($r,$v);
    }

